# Pthreads, OpemMP  

1. [–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã](demo) ‚Äì —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–æ–≤ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è OpenMP.  

    ``` text
    –°–∫–∞—á–∞–π—Ç–µ –∫–æ–¥, —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ:
    $ <cc> <codefile.c> -o <executable> -fopenmp
    –£–∫–∞–∂–∏—Ç–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä (cc), –Ω–∞–ø—Ä–∏–º–µ—Ä, gcc –¥–ª—è .c —Ñ–∞–π–ª–æ–≤ –≤ Ubuntu.
    –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–¥:
    $ ./<executable>
    ```

    ``` text
    omp_hello.c ‚Äì –ø—Ä–æ—Å—Ç–µ–π—à–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–µ—á–∞—Ç–∞—é—â–∞—è ‚ÄòHello world‚Äô. –í–≤–µ–¥–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é ‚Äòparallel‚Äô.  
    –ó–∞–¥–∞–Ω–∏–µ:  
    –∞) –Ω–∞—É—á–∏—Ç–µ—Å—å –≤—Ä—É—á–Ω—É—é –º–µ–Ω—è—Ç—å –∫–æ–ª-–≤–æ –Ω–∏—Ç–µ–π, –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ø—É—Ç–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è:  
    $ export OMP_NUM_THREADS=<number you want>.  
    b) –Ω–∞—É—á–∏—Ç–µ—Å—å –∑–∞–¥–∞–≤–∞—Ç—å –∫–æ–ª-–≤–æ –Ω–∏—Ç–µ–π –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã.  

    omp_outmes.cpp ‚Äì —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ I/O C –∏ C++. –ü—Ä–∏–º–µ—Ä –Ω–∞ –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ–Ω—è—Ç–∏—è ‚Äúthreadsafe‚Äù. –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ critical.  
    –ö–æ–º–ø–∏–ª—è—Ü–∏—è: $ g++ omp_outmes.cpp -o <executable> -fopenmp  

    omp_privateshared.c ‚Äì –ø—Ä–∏–º–µ—Ä –æ–±—â–∏—Ö –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ ‚Äòfor‚Äô.  
    –ó–∞–¥–∞–Ω–∏–µ: –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É, —Ä–∞–∑–±–µ—Ä–∏—Ç–µ—Å—å, —á—Ç–æ –¥–µ–ª–∞—é—Ç –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã —Å #pragma.  

    omp_parsec.c ‚Äì –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ section.  
    –ó–∞–¥–∞–Ω–∏–µ: –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º, –ø–æ–ø—ã—Ç–∞–π—Ç–µ—Å—å —É–≥–∞–¥–∞—Ç—å –≤—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –ø–æ—Ç–æ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ.  

    omp_sumarray.c ‚Äì –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–¥—É–∫—Ü–∏–∏.  
    –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é #pragma omp parallel for ‚Äì  
    –≤ —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —ç—Ç–æ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –∏ #pragma omp parallel ‚Ä¶ #pragma omp for  
    ```

2. –ü—Ä–æ–≥—Ä–∞–º–º—ã —Å –±–∞–≥–∞–º–∏ ‚Äì –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–≥—Ä–∞–º–º, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–¥–æ –ø–æ—á–∏–Ω–∏—Ç—å.  

    ``` text
    omp_bugreduction.c ‚Äì –∫–æ–¥ –¥–ª—è —Å–∫–∞–ª—è—Ä–Ω–æ–≥–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –¥–≤—É—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤.  
    –î–æ–ø–æ–ª–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é dotprod, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–≥–∏ –≤ #pragma omp, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

    omp_bugparfor.c ‚Äì –ù–∞–π—Ç–∏ –∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫–∏.
    ```

3. –ù–∞–ø–∏—Å–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É, –∏—Å–ø–æ–ª—å–∑—É—é—â—É—é –º–µ—Ç–æ–¥ –ú–æ–Ω—Ç–µ-–ö–∞—Ä–ª–æ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —á–∏—Å–ª–∞ pi. –°–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º (–∞–∫–∫—É—Ä–∞—Ç–Ω–µ–µ —Å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–º —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª!) –∫–∏–¥–∞–µ—Ç–µ —Ç–æ—á–∫—É –≤ –µ–¥–∏–Ω–∏—á–Ω—ã–π –∫–≤–∞–¥—Ä–∞—Ç. –í —ç—Ç–æ—Ç –∂–µ –∫–≤–∞–¥—Ä–∞—Ç –≤–ø–∏—Å–∞–Ω –∫—Ä—É–≥. –ï—Å–ª–∏ —Ç–æ—á–∫–∞ –ø–æ–ø–∞–ª–∞ –≤ –∫—Ä—É–≥, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç–µ —Å—á–µ—Ç—á–∏–∫. –ó–∞—Ç–µ–º –Ω–∞—Ö–æ–¥–∏—Ç–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ç–æ—á–µ–∫, –ø–æ–ø–∞–≤—à–∏—Ö –≤ –∫—Ä—É–≥ –∫ –æ–±—â–µ–º—É —á–∏—Å–ª—É —Ç–æ—á–µ–∫. –ó–Ω–∞—è –ø–ª–æ—â–∞–¥–∏ –∫–≤–∞–¥—Ä–∞—Ç–∞ –∏ –∫—Ä—É–≥–∞, –Ω–∞—Ö–æ–¥–∏—Ç–µ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ —á–∏—Å–ª–æ pi.  

4. LeastSquares.c ‚Äì –∑–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞—Ç—å –ª–∏–Ω–µ–π–Ω—É—é —Ä–µ–≥—Ä–µ—Å—Å–∏—é –Ω–∞
–¥–∞–Ω–Ω—ã—Ö (xi,yi) (—Å–æ–∑–¥–∞–π—Ç–µ —Å –ø–æ–º–æ—â—å—é –ª–∏–Ω–µ–π–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ + —à—É–º–∞).
–°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ ùëé, ùëè –≤ –º–æ–¥–µ–ª–∏
ùëì(ùë•, ùëé, ùëè) = ùëéùë• + ùëè. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—ç–º–ø–ª–æ–≤ (xi,yi) –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å
—Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º: ùë¶. = ùëéùë•. + ùëè + ùëõùëúùëñùë†ùëí().
–≠—Ç–∞ –∑–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∞ –≤ –∑–∞–¥–∞—á—É –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏,
—Ç–æ –µ—Å—Ç—å –≤ –∑–∞–¥–∞—á—É –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Å—É–º–º—ã –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –Ω–µ–≤—è–∑–æ–∫ ùëü. = ùë¶. ‚àí
ùëì(ùë•., ùëé, ùëè)  

## –†–µ—à–µ–Ω–∏–µ  

1. –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ OpenMP –∏–∑—É—á–µ–Ω—ã.  

2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º [omp_reduction.c](fixed_bugs/omp_reduction.c) –∏ [omp_parfor.c](fixed_bugs/omp_parfor.c) –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ [/fixed_bugs](fixed_bugs)  

3. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ –ú–æ–Ω—Ç–µ-–ö–∞—Ä–ª–æ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —á–∏—Å–ª–∞ pi - [main](main.c)  
    –°–±–æ—Ä–∫–∞:  
    g++ main.c -o run -fopenmp  

    –ó–∞–ø—É—Å–∫:  
    ./run n_exp n_threads need_print_x_y  
    n_exp - —á–∏—Å–ª–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –º–µ—Ç–æ–¥–∞ (default = 500000),  
    n_threads - —á–∏—Å–ª–æ —Ç—Ä–µ–¥–æ–≤ (default = 4),  
    need_print_x_y - —Ñ–ª–∞–≥ –¥–ª—è –≤—ã–≤–æ–¥–∞ seeds –∏ –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π X, Y (default = False).  

4. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ [–ª–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è](bonus/LeastSquares.c), –æ–±—É—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–π —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–µ–Ω–æ.  
    –°–±–æ—Ä–∫–∞:  
    g++ LeastSquares.c -o run -fopenmp  

    –ó–∞–ø—É—Å–∫:  
    ./run sample_size n_threads need_print_x_y  
    sample_size - —á–∏—Å–ª–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ –º–µ—Ç–æ–¥–∞ (default = 50000),  
    n_threads - —á–∏—Å–ª–æ —Ç—Ä–µ–¥–æ–≤ (default = 4),  
    need_print_x_y - —Ñ–ª–∞–≥ –¥–ª—è –≤—ã–≤–æ–¥–∞ seeds –∏ –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π X, Y (default = False).  
